# Administraci贸n de dominios:
- Estructura grupo de trabajo.
- Estructura cliente-servidor.
- Protocolo LDAP.
- Estructura l贸gica del directorio activo (DA):
  - Concepto de dominio. Subdominios.
  - Unidades organizativas. Objetos.
  - rboles y bosques.
  - Cat谩logo global. Esquema.
  - Funciones de los maestros de operaciones.
- Estructura f铆sica del DA:
  - Concepto de sitio (Site). Optimizaci贸n del tr谩fico de red.
- Configurar la replicaci贸n entre Sites.
- Requisitos necesarios para montar un dominio.
- Administraci贸n de cuentas. Cuentas predeterminadas.
- Contrase帽as. Bloqueos de cuenta.
- Cuentas de usuarios y equipos.
- Perfiles m贸viles y obligatorios.
- Carpetas personales.
- Plantillas de usuario. Variables de entorno.
- Restringir el inicio de sesi贸n de una cuenta:
  - A ciertas horas y d铆as.
  - En determinados ordenadores.
- Scripts de inicio de sesi贸n.
- Administraci贸n de grupos. Tipos. Estrategias de anidamiento. Grupos predeterminados.
- Unidades Organizativas (UO).
  - Estrategias de administraci贸n.

------------------------

# Teor铆a
- Servicios de directorio
  - Dominio (谩rbol, bosque). Controlador de dominio. Miembro del servidor. Nivel funcional. Objetos (OU, grupos, usuarios, equipos)
    - Controlador de dominio adicional: Para tener m谩s de un Controlador de Dominio, simplemente debemos ejecutar el mismo proceso anterior, s贸lo que en este caso durante el asistente le diremos que es Controlador de Dominio adicional, en un Dominio ya existente. En este caso toda la informaci贸n de Active Directory que est谩 en el primero se replicar谩 en el segundo Controlador de Dominio
    - Diferenciar entre Dominio y Controlador de Dominio https://windowserver.wordpress.com/2011/05/05/comprender-active-directory/
    - Funciones del Cat谩logo Global (Global Catalog) https://windowserver.wordpress.com/2011/06/24/funciones-del-catlogo-global-global-catalog/
    - Replicaci贸n https://windowserver.wordpress.com/2014/12/02/windows-server-2012-r2-crear-un-dominio-instalacin-y-configuracin-del-segundo-controlador-de-dominio/
  - Contrase帽as. Bloqueos de cuenta https://www.jesusninoc.com/contrasenas-seguras-con-powershell/
  - Cuentas de usuarios y equipos https://www.jesusninoc.com/03/05/create-users-add-into-a-group-and-share-directory-with-permissions-in-active-directory/
  - Perfiles m贸viles y obligatorios.
  - Carpetas personales.
  - Plantillas de usuario. Variables de entorno.
  - Restringir el inicio de sesi贸n de una cuenta.
  - Scripts de inicio de sesi贸n.

------------------

# Ejercicio
## Hay un problema de seguridad en el hospital, un ransomware ha sido capaz de crear usuarios (no administradores) que pueden crear otros usuarios mediante un script que se ha ejecutado (haciendo clicks) en la cuenta del administrador. Explica mediante capturas y scripts c贸mo se ha realizado (no te agobies, haz lo que sepas).

### Pasos (por ejemplo):
- Crear usuarios leyendo de un fichero
- Script gr谩fico que hace clicks en determinadas zonas de la configuraci贸n de Windows Server
- Dejar el script programado mediante una GPO

### Ayuda
#### Crear OU, usuarios, buscar
```PowerShell
# Crear una OU
New-ADOrganizationalUnit -Name UnidadPS

# Crea un usuario en un lugar determinado
New-ADUSer -Name NombrePs -Sam NombreInicioSesion -Path "OU=UnidadPS,DC=jesusninoc,DC=com"
 -AccountPassword (ConvertTo-SecureString "Contra$ena" -AsPlainText -force) -Enable $true
 
$SAMAccountName = "asir*"
Get-ADUser -LDAPFilter "(samaccountname=$SAMAccountName)"
```

#### M谩s ayuda
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-09-24.md#crear-usuarios-leyendo-desde-un-fichero-explicar-fichero-y-bucle-foreach
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-09-25.md#utilizar-un-filtro-ldap-para-localizar-un-usuario
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-09-25.md#utilizar-un-filtro-ldap-para-verificar-la-hora-del-%C3%BAltimo-inicio-de-sesi%C3%B3n-de-los-usuarios-del-active-directory
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-09-27.md#crear-usuarios-grupos-ous-y-todo-lo-que-quieras-leyendo-de-una-p%C3%A1gina-web
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-10-01.md#instalaci%C3%B3n-configuraci%C3%B3n-objetos-relaciones-de-confianza-gpos-rodc-dc-secundario
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-10-02.md#funci%C3%B3n-comprobar-con-filtro-ldap-soluci%C3%B3n-de-enrique-carreras

---------------

# Administraci贸n del acceso al dominio:
- Equipos del dominio.
- Permisos y derechos.
- Delegaci贸n de permisos / autoridad.
  - Asistente para la delegaci贸n de control.
  - Herramientas de l铆nea de comandos: dsacls.exe y dsrevoke.exe.	う
- Listas de control de acceso.

# Active Directory

## Joining Computers to a Domain
http://community.idera.com/powershell/powertips/b/tips/posts/joining-computers-to-a-domain

## How to Quickly Find Unlinked GPOs in Active Directory
https://www.adamtheautomator.com/how-to-quickly-find-unlinked-gpos-in-active-directory/

## Ejercicios sin scripts
- INSTALAR UN EQUIPO Y METERLO EN EL DOMINIO
- CLONAR EL DISCO DE VUESTRO UBUNTU EN OTRO DISCO QUE SE AADE A LA MQUINA VIRTUAL
- COMPROBAR QUE FUNCIONA EL DISCO CLONADO
- CLONAR POR RED CON SSH
- SACAR LA INFORMACIN DEL DISCO DURO DE LINUX Y LO METES EN UNA IMAGEN EN UNA CARPETA COMPARTIDA DE WINDOWS

## Ejercicios con scripts
- Crear un usuario en el AD, delegar la tarea de "Unir un equipo al dominio" a ese usuario y ejecutar el script para que el equipo se meta en el dominio (desde el equipo que queremos meter en el dominio)
- Analizar GPO
